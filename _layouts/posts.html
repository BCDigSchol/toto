---
layout: page
---

{{ content }}

<style>
  /* small vertical gap after each post that passes the filters */
  .posts-container .post-item { margin-bottom: 1rem; }
</style>

<div class="posts-container w-full flex flex-col justify-start items-center box-border">
  {% assign posts = site.data.posts | sort: 'id' | reverse %}
  {% for post in posts %}
    <div class="post-wrapper w-full" data-post-id="{{ post.id }}">
      {% include post.html post=post %}
    </div>
  {% endfor %}
</div>

<script>
  (function(){
    try{
      var container = document.querySelector('.posts-container');
      if (!container) return;
      var wrappers = Array.prototype.slice.call(container.querySelectorAll('.post-wrapper'));
      if (!wrappers.length) return;
      wrappers.sort(function(a,b){
        var ai = parseInt(a.getAttribute('data-post-id')||0,10);
        var bi = parseInt(b.getAttribute('data-post-id')||0,10);
        return bi - ai;
      });
      wrappers.forEach(function(w){ container.appendChild(w); });
    }catch(e){}
  })();
</script>

<script>
  (function(){
    // Manage like (favorite) state per-post using localStorage key 'favoriteIds' (JSON array of ids as strings)
    try {
      function readFavorites(){
        try{ var v = localStorage.getItem('favoriteIds'); return v ? JSON.parse(v) : []; } catch(e){ return []; }
      }
      function writeFavorites(arr){ try{ localStorage.setItem('favoriteIds', JSON.stringify(arr)); }catch(e){} }

      function isFav(id, list){ return list.indexOf(String(id)) !== -1; }

      document.addEventListener('DOMContentLoaded', function(){
        var favs = readFavorites();
        var buttons = Array.prototype.slice.call(document.querySelectorAll('.post-like'));
        buttons.forEach(function(btn){
          var pid = btn.getAttribute('data-post-id') || (btn.closest && btn.closest('.post-item') && btn.closest('.post-item').getAttribute('data-post-id'));
          if (!pid) return;
          var icon = btn.querySelector('i');
          if (!icon) return;
          var setState = function(liked){
            if (liked) {
              icon.classList.remove('far'); icon.classList.add('fas');
              btn.setAttribute('aria-pressed','true');
              icon.style.color = '#ef4444';
            } else {
              icon.classList.remove('fas'); icon.classList.add('far');
              btn.setAttribute('aria-pressed','false');
              icon.style.color = '';
            }
          };

          setState(isFav(pid, favs));

          btn.addEventListener('click', function(e){
            e.preventDefault();
            favs = readFavorites();
            var liked = isFav(pid, favs);
            if (liked) {
              // remove
              favs = favs.filter(function(x){ return String(x) !== String(pid); });
              setState(false);
            } else {
              favs.push(String(pid));
              setState(true);
            }
            writeFavorites(favs);
          });
        });
      });
    } catch(e) { /* ignore */ }
  })();
</script>

<!-- Image modal (click-to-expand) -->
<div id="image-modal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;padding:1rem;">
  <button id="image-modal-close" aria-label="Close" style="position:absolute;top:1rem;right:1rem;background:transparent;border:none;color:#fff;font-size:1.5rem;cursor:pointer;">Ã—</button>
  <div style="max-width:95%;max-height:95%;display:flex;align-items:center;justify-content:center;">
    <img id="image-modal-img" src="" alt="" style="max-width:100%;max-height:100%;object-fit:contain;border-radius:6px;box-shadow:0 8px 30px rgba(0,0,0,0.5);" />
  </div>
</div>

<script>
  (function(){
    // delegate click to any image inside .post-image
    var container = document.querySelector('.posts-container');
    var modal = document.getElementById('image-modal');
    var modalImg = document.getElementById('image-modal-img');
    var closeBtn = document.getElementById('image-modal-close');

    if (!container || !modal || !modalImg) return;

    container.addEventListener('click', function(e){
      var t = e.target;
      if (t && t.tagName === 'IMG' && t.dataset && t.dataset.fullSrc !== undefined) {
        modalImg.src = t.dataset.fullSrc || t.src;
        modal.style.display = 'flex';
      }
    });

    function closeModal(){ modal.style.display = 'none'; modalImg.src = ''; }

    closeBtn && closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', function(e){
      if (e.target === modal) closeModal();
    });

    // close on ESC
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape') closeModal();
    });
  })();
</script>

<script>
  (function(){
    try{
      if (!('IntersectionObserver' in window)) return;
      var vids = Array.prototype.slice.call(document.querySelectorAll('video'));
      var audios = Array.prototype.slice.call(document.querySelectorAll('audio'));
      var audioAutoplayAllowed = sessionStorage.getItem('autoplayAudio') === '1';

        if (!vids.length) return;
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

        // prepare video elements only; audio will NOT autoplay (opt-in only)
        vids.forEach(function(vid){ try{ vid.muted = true; vid.setAttribute('muted',''); }catch(e){}; vid._userPaused = false; vid.addEventListener('pause', function(){ if (!vid._autoPaused) { vid._userPaused = true; } }); vid.addEventListener('play', function(){ vid._userPaused = false; }); });

        var obs = new IntersectionObserver(function(entries){
          entries.forEach(function(entry){
            var target = entry.target;
            // find a video inside the observed target
            var vid = null;
            if (target.tagName) {
              var tname = target.tagName.toLowerCase();
              if (tname === 'video') vid = target;
            }
            if (!vid && target.querySelector) {
              vid = target.querySelector('video');
            }
            if (!vid) return;

            // Debounce play/pause to avoid quick flicker when scrolling
            if (entry.intersectionRatio >= 0.5) {
              if (vid._userPaused) return;
              if (vid._playTimer) clearTimeout(vid._playTimer);
              vid._playTimer = setTimeout(function(){ try{ vid.muted = true; vid.setAttribute('muted',''); var p = vid.play(); if (p && p.catch) p.catch(function(){}); } catch(e){} }, 200);
            } else {
              if (vid._playTimer) { clearTimeout(vid._playTimer); vid._playTimer = null; }
              try{ if (!vid.paused) { vid._autoPaused = true; vid.pause(); vid._autoPaused = false; } } catch(e){}
            }
          });
        }, { threshold: [0,0.25,0.5,0.75,1] });

        vids.forEach(function(v){ var target = v.closest && v.closest('.post-video') || v; obs.observe(target); });

        document.addEventListener('visibilitychange', function(){ if (document.hidden) { vids.forEach(function(m){ try{ m.pause(); }catch(e){} }); } });

      } catch(e) { }
  })();
</script>

<!-- YouTube lazy-init + autoplay-on-scroll manager -->
<script>
  (function(){
    try{
      if (!('IntersectionObserver' in window)) return;

      // load YT API if not present
      function loadYouTubeAPI(cb){
        if (window.YT && window.YT.Player) {
          if (cb) try{ cb(); }catch(e){}
          return;
        }
        window.__YT_ready_callbacks = window.__YT_ready_callbacks || [];
        if (cb) window.__YT_ready_callbacks.push(cb);
        if (window.__YT_script_loading) return;
        window.__YT_script_loading = true;
        var tag = document.createElement('script'); tag.src = 'https://www.youtube.com/iframe_api';
        var first = document.getElementsByTagName('script')[0]; first.parentNode.insertBefore(tag, first);
        window.onYouTubeIframeAPIReady = function(){
          try{
            (window.__YT_ready_callbacks || []).forEach(function(f){ try{ f(); }catch(e){} });
          }finally{
            window.__YT_ready_callbacks = [];
          }
        };
      }

      var placeholders = Array.prototype.slice.call(document.querySelectorAll('.yt-placeholder'));
      if (!placeholders.length) return;

      var toInit = [];
      placeholders.forEach(function(ph){ if (ph.getAttribute('data-yt-initialized') !== '1') toInit.push(ph); });
      if (!toInit.length) return;

      // Track YT players so we can pause others when one plays and pause when out of view
      var ytPlayers = {}; // pid -> YT.Player
      var elToPid = new WeakMap();

      var obs = new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          var ph = entry.target;
          var id = ph.getAttribute && ph.getAttribute('data-video-id');
          if (!id) return;
          var pid = 'yt-' + id + '-{{ include.post.id | default: include.post.title | slugify }}';

          // if not initialized, create iframe + player but continue observing
          if (ph.getAttribute('data-yt-initialized') !== '1') {
            var iframe = document.createElement('iframe');
            iframe.setAttribute('id', pid);
            iframe.setAttribute('src', 'https://www.youtube.com/embed/' + id + '?rel=0&modestbranding=1&enablejsapi=1');
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen');
            iframe.setAttribute('allowfullscreen', '');
            iframe.style.position = 'absolute'; iframe.style.top='0'; iframe.style.left='0'; iframe.style.width='100%'; iframe.style.height='100%';
            ph.innerHTML = ''; ph.appendChild(iframe); ph.setAttribute('data-yt-initialized','1');

            loadYouTubeAPI(function(){
              try{
                var player = new YT.Player(pid, {
                  events: {
                    'onReady': function(ev){
                      try{
                        ev.target.mute();
                        // if placeholder currently visible, start playback
                        var rect = ph.getBoundingClientRect();
                        var vh = (window.innerHeight || document.documentElement.clientHeight);
                        var visible = Math.max(0, Math.min(rect.bottom, vh) - Math.max(rect.top, 0));
                        var ratio = (rect.height > 0) ? (visible / rect.height) : 0;
                        if (ratio >= 0.5) {
                          try{ ev.target.playVideo(); }catch(e){}
                        }
                      }catch(e){}
                    },
                    'onStateChange': function(state){ /* no-op */ }
                  }
                });
                ytPlayers[pid] = player;
                elToPid.set(ph, pid);
              } catch(e){}
            });
          }

          // If element is visible enough, play its player and pause others; otherwise pause it
          var player = ytPlayers[pid];
          if (entry.intersectionRatio >= 0.5) {
            // try to ensure player exists; if not, schedule later (API will mute onReady)
            var playNow = function(){
              try{
                // pause all other YT players
                for (var k in ytPlayers) { if (k !== pid && ytPlayers[k] && ytPlayers[k].pauseVideo) try{ ytPlayers[k].pauseVideo(); }catch(e){} }
                if (ytPlayers[pid] && ytPlayers[pid].playVideo) try{ ytPlayers[pid].mute && ytPlayers[pid].mute(); ytPlayers[pid].playVideo(); }catch(e){}
              }catch(e){}
            };
            if (player) playNow(); else {
              // try again shortly in case player hasn't been created yet
              setTimeout(function(){ if (ytPlayers[pid]) playNow(); }, 250);
            }
          } else {
            if (player && player.pauseVideo) try{ player.pauseVideo(); }catch(e){}
          }
        });
      }, { threshold: [0,0.25,0.5,0.75,1] });

      toInit.forEach(function(ph){ var target = ph.closest && ph.closest('.post-video') || ph; obs.observe(target); });

    } catch(e){ }
  })();
</script>

<script>
  (function(){
    // Share button: copy item URL to clipboard and show a toast
    try {
      var container = document.querySelector('.posts-container');
      if (!container) return;

      function showToast(msg, x, y){
        var toast = document.getElementById('share-toast');
        if (!toast){
          toast = document.createElement('div');
          toast.id = 'share-toast';
          toast.style.position = 'fixed';
          toast.style.zIndex = '10000';
          toast.style.padding = '0.45rem .75rem';
          toast.style.background = '#9f5252';
          toast.style.color = '#fff';
          toast.style.borderRadius = '6px';
          toast.style.fontSize = '0.95rem';
          toast.style.boxShadow = '0 6px 20px rgba(2,6,23,0.4)';
          toast.style.transition = 'opacity .18s ease, transform .18s ease';
          toast.style.opacity = '0';
          document.body.appendChild(toast);
        }
        toast.textContent = msg;
        // if coordinates provided, position above the button; otherwise center bottom
        if (typeof x === 'number' && typeof y === 'number'){
          toast.style.left = x + 'px';
          toast.style.top = (y - 8) + 'px';
          toast.style.bottom = '';
          toast.style.transform = 'translate(-50%, -100%)';
        } else {
          toast.style.left = '50%';
          toast.style.bottom = '2rem';
          toast.style.top = '';
          toast.style.transform = 'translateX(-50%)';
        }
        toast.style.opacity = '1';
        if (toast._hideTimeout) clearTimeout(toast._hideTimeout);
        toast._hideTimeout = setTimeout(function(){ toast.style.opacity = '0'; }, 2000);
      }

      container.addEventListener('click', function(e){
        var btn = e.target.closest && e.target.closest('.post-share');
        if (!btn) return;
        e.preventDefault();
        var article = btn.closest && btn.closest('.post-item');
        if (!article) return;
        var titleLink = article.querySelector('.post-title a');
        if (!titleLink) return;
        var href = titleLink.getAttribute('href') || '';
        var url = href.match(/^https?:\/\//) ? href : (window.location.origin + (href.charAt(0) === '/' ? href : '/' + href));

        function fallbackCopy(){
          var ta = document.createElement('textarea'); ta.value = url; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select();
          try { document.execCommand('copy'); showToast('Link copied to clipboard'); } catch(err){ showToast('Unable to copy'); }
          document.body.removeChild(ta);
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url).then(function(){
            var rect = btn.getBoundingClientRect();
            var centerX = rect.left + rect.width/2;
            var topY = rect.top;
            showToast('Link copied to clipboard', centerX, topY);
          }).catch(function(){ fallbackCopy(); });
        } else {
          fallbackCopy();
        }
      });

    } catch(e) { /* ignore */ }
  })();
</script>

<script>
  (function(){
    // Client-side filtering: supports ?subject=, ?search=, ?author_name= and ?author_last_initial=.
    // All provided filters apply with AND semantics.
    try {
      var params = new URLSearchParams(window.location.search);
      var subjectParam = params.get('subject');
      var searchParam = params.get('search');
      var authorNameParam = params.get('author_name');
      var authorLastInitialParam = params.get('author_last_initial');
      var authorDepartmentParam = params.get('author_department');
      var favoritesParam = params.get('favorites');
      var favoritesActive = (favoritesParam === 'true' || favoritesParam === '1');
      var favoriteIds = [];
      if (favoritesActive) {
        try { favoriteIds = JSON.parse(localStorage.getItem('favoriteIds') || '[]'); } catch(e){ favoriteIds = []; }
        // normalize to strings
        favoriteIds = (favoriteIds || []).map(function(x){ return String(x); });
      }

      var subject = subjectParam ? subjectParam.toLowerCase() : null;
      var search = searchParam ? searchParam.toLowerCase() : null;
      var authorName = authorNameParam ? authorNameParam.toLowerCase() : null;
      var authorLastInitial = authorLastInitialParam ? authorLastInitialParam.toLowerCase() : null;
      var authorDepartment = authorDepartmentParam ? authorDepartmentParam.toLowerCase() : null;

      var searchTokens = [];
      if (search) {
        searchTokens = search.split(/\s+/).filter(function(t){ return t.length; });
      }

      var container = document.querySelector('.posts-container');
      if (!container) return;
      var items = Array.prototype.slice.call(container.querySelectorAll('.post-item'));
      var anyVisible = false;

      items.forEach(function(item){
        var subjects = (item.getAttribute('data-subjects') || '').toLowerCase();
        var title = (item.getAttribute('data-title') || '').toLowerCase();
        var files = (item.getAttribute('data-files') || '').toLowerCase();
        var desc = (item.getAttribute('data-description') || '').toLowerCase();
        var caps = (item.getAttribute('data-captions') || '').toLowerCase();
        var author = (item.getAttribute('data-author') || '').toLowerCase();
        var authorFirst = (item.getAttribute('data-author-first') || '').toLowerCase();
        var authorLastInitialToken = (item.getAttribute('data-author-last-initial') || '').toLowerCase();
        var authorDeptToken = (item.getAttribute('data-author-department') || '').toLowerCase();
        var authorFirst = (item.getAttribute('data-author-first') || '').toLowerCase();
        var authorLastInitialToken = (item.getAttribute('data-author-last-initial') || '').toLowerCase();
        var authorDeptToken = (item.getAttribute('data-author-department') || '').toLowerCase();

        var subjectMatches = true;
        if (subject) {
          subjectMatches = false;
          var tokens = subjects.split(/[,;]+/).map(function(t){ return t.trim(); });
          for (var i=0;i<tokens.length;i++){ if (tokens[i] === subject) { subjectMatches = true; break; } }
        }

        var searchMatches = true;
        if (searchTokens.length) {
          searchMatches = false;
          // if any token appears in any searchable field, count as a match
          for (var t=0;t<searchTokens.length;t++){
            var tok = searchTokens[t];
            if (!tok) continue;
            if (title.indexOf(tok) !== -1 || files.indexOf(tok) !== -1 || desc.indexOf(tok) !== -1 || caps.indexOf(tok) !== -1 || subjects.indexOf(tok) !== -1 || author.indexOf(tok) !== -1) {
              searchMatches = true;
              break;
            }
          }
        }

        var authorMatches = true;
        if (authorName) {
          authorMatches = false;
          // Prefer explicit data-author-first if available
          if (authorFirst) {
            if (authorFirst === authorName || authorFirst.indexOf(authorName) === 0) authorMatches = true;
          } else {
            var authorParts = author.split(/\s+/).filter(function(s){ return s.length; });
            if (authorParts.length) {
              var firstName = authorParts[0];
              if (firstName === authorName || firstName.indexOf(authorName) === 0) {
                authorMatches = true;
              }
            }
          }
        }
        if (authorLastInitial) {
          var lastInitialMatch = false;
          // Prefer explicit data-author-last-initial if present
          if (authorLastInitialToken) {
            if (authorLastInitialToken === authorLastInitial) lastInitialMatch = true;
          } else {
            var authorParts2 = author.split(/\s+/).filter(function(s){ return s.length; });
            for (var p=0;p<authorParts2.length;p++){
              var tok = authorParts2[p];
              if (tok.length === 1) {
                if (tok.toLowerCase() === authorLastInitial) { lastInitialMatch = true; break; }
              }
            }
          }
          authorMatches = authorMatches && lastInitialMatch;
        }

        var authorDeptMatches = true;
        if (authorDepartment) {
          authorDeptMatches = false;
          if (authorDeptToken) {
            if (authorDeptToken === authorDepartment || authorDeptToken.indexOf(authorDepartment) !== -1) authorDeptMatches = true;
          } else {
            // fallback: check in combined author string
            if (author.indexOf(authorDepartment) !== -1) authorDeptMatches = true;
          }
        }

        var favoriteMatches = true;
        if (favoritesActive) {
          var pidAttr = item.getAttribute('data-post-id') || '';
          favoriteMatches = favoriteIds.indexOf(String(pidAttr)) !== -1;
        }

        // mark whether this item matched the current filters
        if (subjectMatches && searchMatches && authorMatches && authorDeptMatches && favoriteMatches) {
          item.dataset.filtered = 'true';
          item.style.display = '';
          anyVisible = true;
        } else {
          item.dataset.filtered = 'false';
          item.style.display = 'none';
        }
      });
      // Pagination / progressive reveal: show only the first N matched items initially
      var INITIAL_SHOW = 10;
      var LOAD_BATCH = 5;
      function applyPagination(){
        var shown = 0;
        items.forEach(function(it){
          if (it.dataset.filtered === 'true' || (subject===null && search===null && authorName===null && authorLastInitial===null && authorDepartment===null && !favoritesActive)){
            if (shown < INITIAL_SHOW) {
              it.style.display = '';
              shown++;
            } else {
              // hide for now; will be revealed by intersection observer
              it.style.display = 'none';
            }
          } else {
            // keep hidden if filtered out
            it.style.display = 'none';
          }
        });

        // if nothing is visible after filters, show a message
        if (!Array.prototype.slice.call(items).some(function(it){ return it.style.display !== 'none'; })){
          var msg = document.createElement('div');
          msg.className = 'no-results';
          msg.style.padding = '1rem';
          msg.style.color = '#334155';
          var parts = [];
          if (searchParam) parts.push(searchParam);
          if (subjectParam) parts.push(subjectParam);
          if (authorNameParam) parts.push('author: ' + authorNameParam);
          if (authorLastInitialParam) parts.push('last initial: ' + authorLastInitialParam);
          if (authorDepartmentParam) parts.push('department: ' + authorDepartmentParam);
          var q = parts.join(' ');
          msg.textContent = 'No posts found for "' + q + '".';
          container.parentNode.insertBefore(msg, container);
        }
      }

      applyPagination();

      // IntersectionObserver to progressively reveal more items
      var sentinel = document.createElement('div');
      sentinel.id = 'posts-sentinel';
      sentinel.style.width = '100%';
      sentinel.style.height = '1px';
      container.parentNode.appendChild(sentinel);

      function revealMore(){
        var toReveal = [];
        for (var i=0;i<items.length;i++){
          var it = items[i];
          if ((it.dataset.filtered === 'true' || (subject===null && search===null && authorName===null && authorLastInitial===null && authorDepartment===null && !favoritesActive)) && it.style.display === 'none'){
            toReveal.push(it);
            if (toReveal.length >= LOAD_BATCH) break;
          }
        }
        toReveal.forEach(function(it){ it.style.display = ''; });
      }

      // create observer
      var observer = null;
      try {
        observer = new IntersectionObserver(function(entries){
          entries.forEach(function(entry){
            if (entry.isIntersecting) {
              revealMore();
            }
          });
        }, { root: null, rootMargin: '200px', threshold: 0 });
        observer.observe(sentinel);
      } catch(e) { /* ignore if not supported */ }

    } catch(e) { /* fail silently */ }
  })();
</script>