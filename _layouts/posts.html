---
layout: page
---

{{ content }}

<style>
  /* small vertical gap after each post that passes the filters */
  .posts-container .post-item { margin-bottom: 1rem; }
</style>

<div class="posts-container w-full flex flex-col justify-start items-center box-border">
  {% assign posts = site.data.posts | sort: 'id' | reverse %}
  {% for post in posts %}
    <div class="post-wrapper w-full" data-post-id="{{ post.id }}">
      {% include post.html post=post %}
    </div>
  {% endfor %}
</div>

<script>
  (function(){
    try{
      var container = document.querySelector('.posts-container');
      if (!container) return;
      var wrappers = Array.prototype.slice.call(container.querySelectorAll('.post-wrapper'));
      if (!wrappers.length) return;
      wrappers.sort(function(a,b){
        var ai = parseInt(a.getAttribute('data-post-id')||0,10);
        var bi = parseInt(b.getAttribute('data-post-id')||0,10);
        return bi - ai;
      });
      wrappers.forEach(function(w){ container.appendChild(w); });
    }catch(e){}
  })();
</script>

<script>
  (function(){
    // Manage like (favorite) state per-post using localStorage key 'favoriteIds' (JSON array of ids as strings)
    try {
      function readFavorites(){
        try{ var v = localStorage.getItem('favoriteIds'); return v ? JSON.parse(v) : []; } catch(e){ return []; }
      }
      function writeFavorites(arr){ try{ localStorage.setItem('favoriteIds', JSON.stringify(arr)); }catch(e){} }

      function isFav(id, list){ return list.indexOf(String(id)) !== -1; }

      document.addEventListener('DOMContentLoaded', function(){
        var favs = readFavorites();
        var buttons = Array.prototype.slice.call(document.querySelectorAll('.post-like'));
        buttons.forEach(function(btn){
          var pid = btn.getAttribute('data-post-id') || (btn.closest && btn.closest('.post-item') && btn.closest('.post-item').getAttribute('data-post-id'));
          if (!pid) return;
          var icon = btn.querySelector('i');
          if (!icon) return;
          var setState = function(liked){
            if (liked) {
              icon.classList.remove('far'); icon.classList.add('fas');
              btn.setAttribute('aria-pressed','true');
              icon.style.color = '#ef4444';
            } else {
              icon.classList.remove('fas'); icon.classList.add('far');
              btn.setAttribute('aria-pressed','false');
              icon.style.color = '';
            }
          };

          setState(isFav(pid, favs));

          btn.addEventListener('click', function(e){
            e.preventDefault();
            favs = readFavorites();
            var liked = isFav(pid, favs);
            if (liked) {
              // remove
              favs = favs.filter(function(x){ return String(x) !== String(pid); });
              setState(false);
            } else {
              favs.push(String(pid));
              setState(true);
            }
            writeFavorites(favs);
          });
        });
      });
    } catch(e) { /* ignore */ }
  })();
</script>

<!-- Image modal (click-to-expand) -->
<div id="image-modal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;padding:1rem;">
  <button id="image-modal-close" aria-label="Close" style="position:absolute;top:1rem;right:1rem;background:transparent;border:none;color:#fff;font-size:1.5rem;cursor:pointer;">×</button>
  <div style="max-width:95%;max-height:95%;display:flex;align-items:center;justify-content:center;">
    <img id="image-modal-img" src="" alt="" style="max-width:100%;max-height:100%;object-fit:contain;border-radius:6px;box-shadow:0 8px 30px rgba(0,0,0,0.5);" />
  </div>
</div>

<script>
  (function(){
    // delegate click handling for favorites, share, and image modal
    var container = document.querySelector('.posts-container');
    var modal = document.getElementById('image-modal');
    var modalImg = document.getElementById('image-modal-img');
    var closeBtn = document.getElementById('image-modal-close');

    if (!container) return;

    function readFavsLocal(){ try{ return JSON.parse(localStorage.getItem('favoriteIds')||'[]'); }catch(e){ return []; } }
    function writeFavsLocal(arr){ try{ localStorage.setItem('favoriteIds', JSON.stringify(arr)); }catch(e){} }

    function toggleFavorite(el){
      var article = el.closest && el.closest('.post-item'); if (!article) return;
      var id = article.getAttribute('data-post-id'); if(!id) return;
      var ids = readFavsLocal(); var idx = ids.indexOf(String(id));
      if (idx === -1) { ids.push(String(id)); el.classList.add('favorited'); }
      else { ids.splice(idx,1); el.classList.remove('favorited'); }
      writeFavsLocal(ids);
    }

    function openModalWithSrc(src){ if (!modal || !modalImg) return; modalImg.src = src; modal.style.display = 'flex'; document.body.style.overflow = 'hidden'; }
    function closeModal(){ if (!modal) return; modal.style.display = 'none'; if (modalImg) modalImg.src = ''; document.body.style.overflow = ''; }

    container.addEventListener('click', function(e){
      // favorite click
      var fav = e.target.closest && e.target.closest('.post-like');
      if (fav) { e.preventDefault(); toggleFavorite(fav); return; }

      // unified share button
      var shareBtn = e.target.closest && e.target.closest('.post-share');
      if (shareBtn) {
        e.preventDefault();
        var article = shareBtn.closest && shareBtn.closest('.post-item'); if (!article) return;
        var titleEl = article.querySelector('.post-title a');
        var title = titleEl ? titleEl.textContent.trim() : '';
        var href = titleEl ? titleEl.getAttribute('href') : window.location.href;
        var url = href.match(/^https?:\/\//) ? href : (window.location.origin + (href.charAt(0)==='/'? href : '/' + href));
        if (typeof createSharePopup === 'function') createSharePopup(shareBtn, { url: url, title: title });
        return;
      }

      // image click (open modal)
      var imgWrap = e.target.closest && e.target.closest('.post-image');
      if (imgWrap) {
        var img = imgWrap.querySelector && imgWrap.querySelector('img');
        if (img && img.src) { e.preventDefault(); openModalWithSrc(img.src); return; }
      }
      var img = e.target.closest && e.target.closest('img');
      if (img && img.closest && img.closest('.post-item')) { e.preventDefault(); openModalWithSrc(img.src); return; }
    });

    if (closeBtn) closeBtn.addEventListener('click', function(e){ e.stopPropagation(); closeModal(); });
    if (modal) modal.addEventListener('click', function(e){ if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeModal(); });

        // clicks inside the popup
        var popupAction = e.target.closest && e.target.closest('#share-popup .share-action');
        if(popupAction){
          e.preventDefault();
          var action = popupAction.getAttribute('data-action');
          var popup = document.getElementById('share-popup');
          if(!popup) return;
          var url = popup.dataset.url || window.location.href;
          var title = popup.dataset.title || '';
          if(action === 'x'){
            shareToX(url, title);
            closeSharePopup();
            return;
          }
          if(action === 'bsky'){
            shareToBluesky(url, title);
            closeSharePopup();
            return;
          }
          if(action === 'copy'){
            copyToClipboard(url).then(function(){ showToast('Link copied!'); }).catch(function(){ showToast('Copy failed'); });
            closeSharePopup();
            return;
          }
        }
      });

            // Debounce play/pause to avoid quick flicker when scrolling
            if (entry.intersectionRatio >= 0.5) {
              if (vid._userPaused) return;
              if (vid._playTimer) clearTimeout(vid._playTimer);
              vid._playTimer = setTimeout(function(){ try{ vid.muted = true; vid.setAttribute('muted',''); tryPlayWhenBuffered(vid, 4000).catch(function(){ try{ showToast('Autoplay blocked — tap to play'); }catch(e){} }); } catch(e){} }, 200);
            } else {
              if (vid._playTimer) { clearTimeout(vid._playTimer); vid._playTimer = null; }
              try{ if (!vid.paused) { vid._autoPaused = true; vid.pause(); vid._autoPaused = false; } } catch(e){}
            }
          });
        }, { threshold: [0,0.25,0.5,0.75,1] });

        vids.forEach(function(v){ var target = v.closest && v.closest('.post-video') || v; obs.observe(target); });

        document.addEventListener('visibilitychange', function(){ if (document.hidden) { vids.forEach(function(m){ try{ m.pause(); }catch(e){} }); } });

      } catch(e) { }
  })();
</script>

<!-- YouTube lazy-init + autoplay-on-scroll manager -->
<script>
  (function(){
    try{
      if (!('IntersectionObserver' in window)) return;

      // load YT API if not present
      function loadYouTubeAPI(cb){
        if (window.YT && window.YT.Player) {
          if (cb) try{ cb(); }catch(e){}
          return;
        }
        window.__YT_ready_callbacks = window.__YT_ready_callbacks || [];
        if (cb) window.__YT_ready_callbacks.push(cb);
        if (window.__YT_script_loading) return;
        window.__YT_script_loading = true;
        var tag = document.createElement('script'); tag.src = 'https://www.youtube.com/iframe_api';
        var first = document.getElementsByTagName('script')[0]; first.parentNode.insertBefore(tag, first);
        window.onYouTubeIframeAPIReady = function(){
          try{
            (window.__YT_ready_callbacks || []).forEach(function(f){ try{ f(); }catch(e){} });
          }finally{
            window.__YT_ready_callbacks = [];
          }
        };
      }

      var placeholders = Array.prototype.slice.call(document.querySelectorAll('.yt-placeholder'));
      // do not return if there are no YT placeholders; continue so local HTML5 videos are managed

      var toInit = [];
      placeholders.forEach(function(ph){ if (ph.getAttribute('data-yt-initialized') !== '1') toInit.push(ph); });
      if (!toInit.length) return;

      // Track YT players so we can pause others when one plays and pause when out of view
      var ytPlayers = {}; // pid -> YT.Player
      var elToPid = new WeakMap();

      // Also manage local HTML5 videos as part of the same autoplay system
      window.__mediaAutoplayManager = window.__mediaAutoplayManager || {};
      var html5Videos = [];
      function registerHtml5Videos(){
        try{
          html5Videos = Array.prototype.slice.call(document.querySelectorAll('.post-video video'));
          html5Videos.forEach(function(vid){
            try{
              // ensure attributes that enable muted autoplay are present before play is attempted
              vid.setAttribute('playsinline','');
              vid.setAttribute('muted','');
              vid.muted = true;
              if (!vid.getAttribute('preload')) vid.setAttribute('preload','metadata');
            }catch(e){}
            // track user pause/play so autoplay doesn't fight the user
            vid._userPaused = false;
            vid.addEventListener('pause', function(){ if (!vid._autoPaused) vid._userPaused = true; });
            vid.addEventListener('play', function(){ vid._userPaused = false; });
          });
        }catch(e){ html5Videos = []; }
      }
      // register now and on DOM changes
      registerHtml5Videos();
      
      // helper: attempt to play a video but wait until it's buffered enough to avoid play() rejections
      function tryPlayWhenBuffered(vid, timeout){
        timeout = typeof timeout === 'number' ? timeout : 4000;
        return new Promise(function(resolve, reject){
          try{
            if (!vid) return reject(new Error('no-video'));
            // ensure attributes for muted autoplay
            try{ vid.setAttribute('playsinline',''); vid.setAttribute('muted',''); vid.muted = true; }catch(e){}

            var fired = false;
            function cleanup(){
              try{ vid.removeEventListener('canplay', onCan); vid.removeEventListener('canplaythrough', onCan); }catch(e){}
              if (timer) { clearTimeout(timer); timer = null; }
            }
            function attemptPlay(){
              if (fired) return;
              fired = true;
              try{
                var p = vid.play();
                if (p && p.then) {
                  p.then(function(){ cleanup(); resolve(); }).catch(function(err){ cleanup(); reject(err); });
                } else {
                  cleanup(); resolve();
                }
              }catch(err){ cleanup(); reject(err); }
            }
            function onCan(){ attemptPlay(); }

            // if already buffered sufficiently, try immediately
            try{
              if (vid.readyState >= 3) { attemptPlay(); return; }
            }catch(e){}

            vid.addEventListener('canplay', onCan);
            vid.addEventListener('canplaythrough', onCan);
            var timer = setTimeout(function(){ attemptPlay(); }, timeout);
          }catch(err){ reject(err); }
        });
      }
      try{ window.tryPlayWhenBuffered = tryPlayWhenBuffered; }catch(e){}
      var _ma_timer = null;
      try{ var _ma_observer = new MutationObserver(function(){ if (_ma_timer) clearTimeout(_ma_timer); _ma_timer = setTimeout(registerHtml5Videos, 200); }); _ma_observer.observe(document.body, { childList:true, subtree:true }); }catch(e){}

      var obs = new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          var target = entry.target;
          // If this is a YT placeholder, handle via YT player flow
          var isYT = target.getAttribute && target.getAttribute('data-video-id');
          if (isYT) {
            var ph = target;
            var id = ph.getAttribute('data-video-id');
            if (!id) return;
            var pid = 'yt-' + id + '-{{ include.post.id | default: include.post.title | slugify }}';

            // if not initialized, create iframe + player but continue observing
            if (ph.getAttribute('data-yt-initialized') !== '1') {
              var iframe = document.createElement('iframe');
              iframe.setAttribute('id', pid);
              iframe.setAttribute('src', 'https://www.youtube.com/embed/' + id + '?rel=0&modestbranding=1&enablejsapi=1');
              iframe.setAttribute('frameborder', '0');
              iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen');
              iframe.setAttribute('allowfullscreen', '');
              iframe.style.position = 'absolute'; iframe.style.top='0'; iframe.style.left='0'; iframe.style.width='100%'; iframe.style.height='100%';
              ph.innerHTML = ''; ph.appendChild(iframe); ph.setAttribute('data-yt-initialized','1');

              loadYouTubeAPI(function(){
                try{
                  var player = new YT.Player(pid, {
                    events: {
                      'onReady': function(ev){
                        try{
                          ev.target.mute();
                          // if placeholder currently visible, start playback
                          var rect = ph.getBoundingClientRect();
                          var vh = (window.innerHeight || document.documentElement.clientHeight);
                          var visible = Math.max(0, Math.min(rect.bottom, vh) - Math.max(rect.top, 0));
                          var ratio = (rect.height > 0) ? (visible / rect.height) : 0;
                          if (ratio >= 0.5) {
                            try{ ev.target.playVideo(); }catch(e){}
                          }
                        }catch(e){}
                      },
                      'onStateChange': function(state){ /* no-op */ }
                    }
                  });
                  ytPlayers[pid] = player;
                  elToPid.set(ph, pid);
                } catch(e){}
              });
            }

            var player = ytPlayers[pid];
            if (entry.intersectionRatio >= 0.5) {
              var playNow = function(){
                try{
                  // pause all other YT players
                  for (var k in ytPlayers) { if (k !== pid && ytPlayers[k] && ytPlayers[k].pauseVideo) try{ ytPlayers[k].pauseVideo(); }catch(e){} }
                  // pause all html5 videos
                  html5Videos.forEach(function(v){ try{ if (!v.paused) { v._autoPaused = true; v.pause(); v._autoPaused = false; } }catch(e){} });
                  if (ytPlayers[pid] && ytPlayers[pid].playVideo) try{ ytPlayers[pid].mute && ytPlayers[pid].mute(); ytPlayers[pid].playVideo(); }catch(e){}
                }catch(e){}
              };
              if (player) playNow(); else { setTimeout(function(){ if (ytPlayers[pid]) playNow(); }, 250); }
            } else {
              if (player && player.pauseVideo) try{ player.pauseVideo(); }catch(e){}
            }
            return; // handled
          }

          // Otherwise, handle HTML5 video elements
          var vid = null;
          if (target.tagName === 'VIDEO') vid = target; else if (target.querySelector) vid = target.querySelector('video');
          if (!vid) return;
          // Respect user pause
          if (entry.intersectionRatio >= 0.5) {
            if (vid._userPaused) return;
            try{
              // pause YT players
              for (var k2 in ytPlayers) { if (ytPlayers[k2] && ytPlayers[k2].pauseVideo) try{ ytPlayers[k2].pauseVideo(); }catch(e){} }
              // pause other html5 videos
              html5Videos.forEach(function(v){ if (v !== vid) { try{ if (!v.paused) { v._autoPaused = true; v.pause(); v._autoPaused = false; } }catch(e){} } });
              // play this one muted
              try{ vid.muted = true; vid.setAttribute('muted',''); tryPlayWhenBuffered(vid, 4000).catch(function(){ try{ showToast('Autoplay blocked — tap to play'); }catch(e){} }); }catch(e){}
            }catch(e){}
          } else {
            try{ if (!vid.paused) { vid._autoPaused = true; vid.pause(); vid._autoPaused = false; } }catch(e){}
          }
        });
      }, { threshold: [0,0.25,0.5,0.75,1] });

      toInit.forEach(function(ph){ var target = ph.closest && ph.closest('.post-video') || ph; obs.observe(target); });
      // observe registered HTML5 videos as well
      try{ html5Videos.forEach(function(v){ var t = v.closest && v.closest('.post-video') || v; obs.observe(t); }); }catch(e){}

    } catch(e){ }
  })();
</script>

<script>
  (function(){
    // Share button: copy item URL to clipboard and show a toast
    try {
      var container = document.querySelector('.posts-container');
      if (!container) return;

      function showToast(msg, x, y){
        var toast = document.getElementById('share-toast');
        if (!toast){
          toast = document.createElement('div');
          toast.id = 'share-toast';
          toast.style.position = 'fixed';
          toast.style.zIndex = '10000';
          toast.style.padding = '0.45rem .75rem';
          toast.style.background = '#9f5252';
          toast.style.color = '#fff';
          toast.style.borderRadius = '6px';
          toast.style.fontSize = '0.95rem';
          toast.style.boxShadow = '0 6px 20px rgba(2,6,23,0.4)';
          toast.style.transition = 'opacity .18s ease, transform .18s ease';
          toast.style.opacity = '0';
          document.body.appendChild(toast);
        }
        toast.textContent = msg;
        // if coordinates provided, position above the button; otherwise center bottom
        if (typeof x === 'number' && typeof y === 'number'){
          toast.style.left = x + 'px';
          toast.style.top = (y - 8) + 'px';
          toast.style.bottom = '';
          toast.style.transform = 'translate(-50%, -100%)';
        } else {
          toast.style.left = '50%';
          toast.style.bottom = '2rem';
          toast.style.top = '';
          toast.style.transform = 'translateX(-50%)';
        }
        toast.style.opacity = '1';
        if (toast._hideTimeout) clearTimeout(toast._hideTimeout);
        toast._hideTimeout = setTimeout(function(){ toast.style.opacity = '0'; }, 2000);
      }

      /* Share popup helpers ------------------------------------------------ */
      function copyToClipboard(text){
        return new Promise(function(resolve, reject){
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(resolve).catch(reject);
            return;
          }
          try {
            var ta = document.createElement('textarea'); ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); document.body.removeChild(ta); resolve(); } catch(e){ document.body.removeChild(ta); reject(e); }
          } catch(e){ reject(e); }
        });
      }

      var _sharePopup = null;
      function closeSharePopup(){
        if (_sharePopup && _sharePopup.parentNode) _sharePopup.parentNode.removeChild(_sharePopup);
        _sharePopup = null;
        document.removeEventListener('click', _handleDocClick);
        document.removeEventListener('keydown', _handleEsc);
      }

      function _handleDocClick(e){
        if (!_sharePopup) return;
        if (e.target.closest && e.target.closest('#share-popup')) return; // inside popup
        if (e.target.closest && e.target.closest('.post-share')) return; // clicked another share button
        closeSharePopup();
      }
      function _handleEsc(e){ if (e.key === 'Escape') closeSharePopup(); }

      function createSharePopup(anchor, meta){
        closeSharePopup();
        var rect = anchor.getBoundingClientRect();
        var popup = document.createElement('div');
        popup.id = 'share-popup';
        popup.style.position = 'absolute';
        popup.style.zIndex = 10001;
        popup.style.display = 'flex';
        popup.style.gap = '.35rem';
        popup.style.padding = '.4rem';
        popup.style.borderRadius = '8px';
        popup.style.boxShadow = '0 6px 20px rgba(2,6,23,0.12)';
        popup.style.background = 'var(--card-bg, #fff)';
        popup.style.color = 'inherit';
        popup.style.border = '1px solid rgba(0,0,0,0.06)';

        // buttons: Twitter/X, Bluesky, Instagram, TikTok, Link (copy)
        popup.innerHTML = '' +
          '<button class="share-action" data-action="x" title="Share to X" style="background:transparent;border:none;padding:.35rem;cursor:pointer;">' +
            '<svg width="18" height="18" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM457.1 180L353.3 298.6L475.4 460L379.8 460L305 362.1L219.3 460L171.8 460L282.8 333.1L165.7 180L263.7 180L331.4 269.5L409.6 180L457.1 180zM419.3 431.6L249.4 206.9L221.1 206.9L392.9 431.6L419.3 431.6z"/></svg>' +
          '</button>' +
          '<button class="share-action" data-action="bsky" title="Share to Bluesky" style="background:transparent;border:none;padding:.35rem;cursor:pointer;">' +
            '<svg width="18" height="18" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM320 311.4C334.5 281.4 374 225.6 410.7 198.1C437.2 178.2 480 162.9 480 211.8C480 221.6 474.4 293.9 471.1 305.6C459.7 346.4 418.1 356.8 381.1 350.5C445.8 361.5 462.3 398 426.7 434.5C359.2 503.8 329.7 417.1 322.1 394.9L321.8 394C320.9 391.4 320.4 389.9 320 389.9C319.6 389.9 319.1 391.4 318.2 394C318.1 394.3 318 394.6 317.9 394.9C310.3 417.1 280.8 503.7 213.3 434.5C177.8 398 194.2 361.5 258.9 350.5C221.9 356.8 180.3 346.4 168.9 305.6C165.6 293.9 160 221.6 160 211.8C160 162.9 202.9 178.3 229.3 198.1C266 225.6 305.5 281.5 320 311.4z"/></svg>' +
          '</button>' +
          '<button class="share-action" data-action="instagram" title="Share to Instagram" style="background:transparent;border:none;padding:.35rem;cursor:pointer;">' +
            '<svg width="18" height="18" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M290.4 275.7C274 286 264.5 304.5 265.5 323.8C266.6 343.2 278.2 360.4 295.6 368.9C313.1 377.3 333.8 375.5 349.6 364.3C366 354 375.5 335.5 374.5 316.2C373.4 296.8 361.8 279.6 344.4 271.1C326.9 262.7 306.2 264.5 290.4 275.7zM432.7 207.3C427.5 202.1 421.2 198 414.3 195.3C396.2 188.2 356.7 188.5 331.2 188.8C327.1 188.8 323.3 188.9 320 188.9C316.7 188.9 312.8 188.9 308.6 188.8C283.1 188.5 243.8 188.1 225.7 195.3C218.8 198 212.6 202.1 207.3 207.3C202 212.5 198 218.8 195.3 225.7C188.2 243.8 188.6 283.4 188.8 308.9C188.8 313 188.9 316.8 188.9 320C188.9 323.2 188.9 327 188.8 331.1C188.6 356.6 188.2 396.2 195.3 414.3C198 421.2 202.1 427.4 207.3 432.7C212.5 438 218.8 442 225.7 444.7C243.8 451.8 283.3 451.5 308.8 451.2C312.9 451.2 316.7 451.1 320 451.1C323.3 451.1 327.2 451.1 331.4 451.2C356.9 451.5 396.2 451.9 414.3 444.7C421.2 442 427.4 437.9 432.7 432.7C438 427.5 442 421.2 444.7 414.3C451.9 396.3 451.5 356.9 451.2 331.3C451.2 327.1 451.1 323.2 451.1 319.9C451.1 316.6 451.1 312.8 451.2 308.5C451.5 283 451.9 243.6 444.7 225.5C442 218.6 437.9 212.4 432.7 207.1L432.7 207.3zM365.6 251.8C383.7 263.9 396.2 282.7 400.5 304C404.8 325.3 400.3 347.5 388.2 365.6C382.2 374.6 374.5 382.2 365.6 388.2C356.7 394.2 346.6 398.3 336 400.4C314.7 404.6 292.5 400.2 274.4 388.1C256.3 376 243.8 357.2 239.5 335.9C235.2 314.6 239.7 292.4 251.7 274.3C263.7 256.2 282.6 243.7 303.9 239.4C325.2 235.1 347.4 239.6 365.5 251.6L365.6 251.6zM394.8 250.5C391.7 248.4 389.2 245.4 387.7 241.9C386.2 238.4 385.9 234.6 386.6 230.8C387.3 227 389.2 223.7 391.8 221C394.4 218.3 397.9 216.5 401.6 215.8C405.3 215.1 409.2 215.4 412.7 216.9C416.2 218.4 419.2 220.8 421.3 223.9C423.4 227 424.5 230.7 424.5 234.5C424.5 237 424 239.5 423.1 241.8C422.2 244.1 420.7 246.2 419 248C417.3 249.8 415.1 251.2 412.8 252.2C410.5 253.2 408 253.7 405.5 253.7C401.7 253.7 398 252.6 394.9 250.5L394.8 250.5zM544 160C544 124.7 515.3 96 480 96L160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160zM453 453C434.3 471.7 411.6 477.6 386 478.9C359.6 480.4 280.4 480.4 254 478.9C228.4 477.6 205.7 471.7 187 453C168.3 434.3 162.4 411.6 161.2 386C159.7 359.6 159.7 280.4 161.2 254C162.5 228.4 168.3 205.7 187 187C205.7 168.3 228.5 162.4 254 161.2C280.4 159.7 359.6 159.7 386 161.2C411.6 162.5 434.3 168.3 453 187C471.7 205.7 477.6 228.4 478.8 254C480.3 280.3 480.3 359.4 478.8 385.9C477.5 411.5 471.7 434.2 453 452.9L453 453z"/></svg>' +
          '</button>' +
          '<button class="share-action" data-action="tiktok" title="Share to TikTok" style="background:transparent;border:none;padding:.35rem;cursor:pointer;">' +
            '<svg width="18" height="18" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M544.5 273.9C500.5 274 457.5 260.3 421.7 234.7L421.7 413.4C421.7 446.5 411.6 478.8 392.7 506C373.8 533.2 347.1 554 316.1 565.6C285.1 577.2 251.3 579.1 219.2 570.9C187.1 562.7 158.3 545 136.5 520.1C114.7 495.2 101.2 464.1 97.5 431.2C93.8 398.3 100.4 365.1 116.1 336C131.8 306.9 156.1 283.3 185.7 268.3C215.3 253.3 248.6 247.8 281.4 252.3L281.4 342.2C266.4 337.5 250.3 337.6 235.4 342.6C220.5 347.6 207.5 357.2 198.4 369.9C189.3 382.6 184.4 398 184.5 413.8C184.6 429.6 189.7 444.8 199 457.5C208.3 470.2 221.4 479.6 236.4 484.4C251.4 489.2 267.5 489.2 282.4 484.3C297.3 479.4 310.4 469.9 319.6 457.2C328.8 444.5 333.8 429.1 333.8 413.4L333.8 64L421.8 64C421.7 71.4 422.4 78.9 423.7 86.2C426.8 102.5 433.1 118.1 442.4 131.9C451.7 145.7 463.7 157.5 477.6 166.5C497.5 179.6 520.8 186.6 544.6 186.6L544.6 274z"/></svg>' +
          '</button>' +
          '<button class="share-action" data-action="copy" title="Copy link" style="background:transparent;border:none;padding:.35rem;cursor:pointer;">' +
            '<i class="fa-solid fa-link" aria-hidden="true" style="font-size:18px;line-height:1;display:inline-block;vertical-align:middle;"></i>' +
          '</button>';

        document.body.appendChild(popup);
        _sharePopup = popup;
        // normalize to absolute URL
        function absUrl(u){
          try{ if (!u) return window.location.href; if (/^https?:\/\//i.test(u)) return u; if (u.charAt(0) === '/') return window.location.origin + u; return window.location.origin + '/' + u; }catch(e){ return u; }
        }
        popup.dataset.url = absUrl(meta.url);
        popup.dataset.title = meta.title || '';

        // wire popup actions locally so clicks inside the popup are handled here
        popup.addEventListener('click', function(ev){
          var btn = ev.target.closest && ev.target.closest('.share-action');
          if (!btn) return;
          ev.preventDefault();
          var action = btn.getAttribute('data-action');
          var url = popup.dataset.url || window.location.href;
          var title = popup.dataset.title || '';
          if (action === 'x') { shareToX(url, title); closeSharePopup(); return; }
          if (action === 'bsky') { shareToBluesky(url, title); closeSharePopup(); return; }
          if (action === 'instagram') { shareToInstagram(url, title); closeSharePopup(); return; }
          if (action === 'tiktok') { shareToTikTok(url, title); closeSharePopup(); return; }
          if (action === 'copy') { copyToClipboard(url).then(function(){ showToast('Link copied!'); }).catch(function(){ showToast('Copy failed'); }); closeSharePopup(); return; }
        });

        // position
        var left = rect.left + window.scrollX;
        var top = rect.bottom + window.scrollY + 8;
        // ensure fits horizontally
        popup.style.left = Math.max(8, left) + 'px';
        popup.style.top = top + 'px';

        // attach document handlers to close when clicking outside
        setTimeout(function(){ document.addEventListener('click', _handleDocClick); document.addEventListener('keydown', _handleEsc); }, 10);
      }

      // expose createSharePopup globally so other scripts can open it
      try{ window.createSharePopup = createSharePopup; }catch(e){}

      /* end share popup helpers -------------------------------------------- */
      function shareToBluesky(url, title){
        var text = (title ? (title + ' ') : '') + url;
        var webUrl = 'https://bsky.app';
        // Attempt deep-link to Bluesky native app. If app is not installed, fallback to copying text and opening web.
        var appUrl = 'bsky://compose?text=' + encodeURIComponent(text);

        var didHide = false;
        function cleanup(iframe, timer){
          if (timer) clearTimeout(timer);
          document.removeEventListener('visibilitychange', onVisibility);
          try{ if (iframe && iframe.parentNode) iframe.parentNode.removeChild(iframe); }catch(e){}
        }
        function onVisibility(){ if (document.hidden) { didHide = true; } }

        // Fallback behaviour: copy text to clipboard (if possible) then open web url
        function fallback(){
          if (navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(text).then(function(){ window.open(webUrl, '_blank'); showToast('Link copied — paste into Bluesky'); }).catch(function(){ window.open(webUrl, '_blank'); showToast('Open Bluesky to paste'); });
            return;
          }
          try {
            var ta = document.createElement('textarea'); ta.value = text; ta.style.position = 'fixed'; ta.style.left = '-9999px'; document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); showToast('Link copied — paste into Bluesky'); } catch(e){ showToast('Open Bluesky to paste'); }
            document.body.removeChild(ta);
          } catch(e) {}
          window.open(webUrl, '_blank');
        }

        // Try opening app using an iframe. If the app opens, page will become hidden; otherwise timeout triggers fallback.
        try{
          var iframe = document.createElement('iframe'); iframe.style.display = 'none'; iframe.src = appUrl;
          document.body.appendChild(iframe);
          document.addEventListener('visibilitychange', onVisibility);
          var timer = setTimeout(function(){
            cleanup(iframe, timer);
            if (!didHide) fallback();
          }, 800);
        }catch(e){
          // if anything goes wrong, just do the fallback
          fallback();
        }
      }

      function shareToInstagram(url, title){
        var _url = (url && (/^https?:\/\//i.test(url))) ? url : (window.location.origin + (url && url.charAt(0) === '/' ? url : ('/' + (url||''))));
        var text = (title ? (title + ' ') : '') + _url;
        var appUrl = 'instagram://share?text=' + encodeURIComponent(text);

        // Detect mobile devices
        var isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent || '');

        // Prefer Web Share API on mobile — opens native share sheet/app
        if (isMobile) {
          try{
            if (navigator.share && typeof navigator.share === 'function'){
              navigator.share({ title: title || document.title, text: text, url: _url }).then(function(){ try{ showToast('Opened share sheet'); }catch(e){} }).catch(function(){ /* ignore */ });
              return;
            }
          }catch(e){}

          // Fallback on mobile: attempt app deep-link in a new window, then open post URL and copy text
          var win = null;
          try { win = window.open('', '_blank'); } catch(e) { win = null; }
          if (win) {
            try { win.location = appUrl; } catch(e) { /* some browsers may throw */ }
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).catch(function(){});
            } else {
              try{ var ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
            }
            setTimeout(function(){
              try { win.location = _url; } catch(e) { try{ window.open(_url, '_blank'); }catch(e){} }
              try{ showToast('Link copied — open Instagram to paste'); }catch(e){}
            }, 800);
            return;
          }

          // If window.open failed (blocked) on mobile, fallback to copying and opening post URL directly
          try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).then(function(){ window.open(_url, '_blank'); try{ showToast('Link copied — open Instagram to paste'); }catch(e){} }, function(){ window.open(_url, '_blank'); try{ showToast('Open Instagram to paste'); }catch(e){} });
              return;
            }
          } catch(e){}
          try { var ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
          try{ window.open(_url, '_blank'); try{ showToast('Link copied — open Instagram to paste'); }catch(e){} }catch(e){}
          return;
        }

        // Desktop fallback: copy share text first, then attempt to open the app scheme (Instagram)
        function _execCopyFallback(t){
          return new Promise(function(resolve){
            try{ var ta=document.createElement('textarea'); ta.value=t; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
            resolve();
          });
        }

        function _copyThenOpenApp(appScheme){
          var copyPromise = (navigator.clipboard && navigator.clipboard.writeText) ? navigator.clipboard.writeText(_url).catch(function(){ return _execCopyFallback(_url); }) : _execCopyFallback(_url);
          copyPromise.then(function(){
            // Attempt to open app scheme in a new tab/window
            var opened = false;
            try {
              var w = window.open(appScheme, '_blank');
              if (w) opened = true;
            } catch(e){}
            // If window.open didn't work, try iframe method
            if (!opened) {
              try {
                var ifr = document.createElement('iframe');
                ifr.style.display = 'none';
                ifr.src = appScheme;
                document.body.appendChild(ifr);
                setTimeout(function(){ try{ document.body.removeChild(ifr); }catch(e){} }, 1000);
              } catch(e){}
            }
            try{ showToast('Link copied — open Instagram and paste'); }catch(e){}
          }).catch(function(){
            // Still try to open app even if copy fails
            try{ window.open(appScheme, '_blank'); }catch(e){}
          });
        }

        // Open Instagram website after copying URL (desktop users can paste there)
        _copyThenOpenApp('https://www.instagram.com');
      }

      function shareToTikTok(url, title){
        var _url = (url && (/^https?:\/\//i.test(url))) ? url : (window.location.origin + (url && url.charAt(0) === '/' ? url : ('/' + (url||''))));
        var text = (title ? (title + ' ') : '') + _url;
        var appUrl = 'tiktok://share?text=' + encodeURIComponent(text);

        // Detect mobile devices
        var isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent || '');

        // Prefer Web Share API on mobile
        if (isMobile) {
          try{
            if (navigator.share && typeof navigator.share === 'function'){
              navigator.share({ title: title || document.title, text: text, url: _url }).then(function(){ try{ showToast('Opened share sheet'); }catch(e){} }).catch(function(){ /* ignore */ });
              return;
            }
          }catch(e){}

          var win = null;
          try { win = window.open('', '_blank'); } catch(e) { win = null; }
          if (win) {
            try { win.location = appUrl; } catch(e) {}
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).catch(function(){});
            } else {
              try{ var ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
            }
            setTimeout(function(){ try { win.location = _url; } catch(e) { try{ window.open(_url, '_blank'); }catch(e){} } try{ showToast('Link copied — open TikTok to paste'); }catch(e){} }, 800);
            return;
          }

          try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).then(function(){ window.open(_url, '_blank'); try{ showToast('Link copied — open TikTok to paste'); }catch(e){} }, function(){ window.open(_url, '_blank'); try{ showToast('Open TikTok to paste'); }catch(e){} });
              return;
            }
          } catch(e){}
          try { var ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
          try{ window.open(_url, '_blank'); try{ showToast('Link copied — open TikTok to paste'); }catch(e){} }catch(e){}
          return;
        }

        // Desktop fallback: copy share text first, then attempt to open the app scheme (TikTok)
        function _execCopyFallback2(t){
          return new Promise(function(resolve){
            try{ var ta=document.createElement('textarea'); ta.value=t; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }catch(e){}
            resolve();
          });
        }

        function _copyThenOpenApp2(appScheme){
          var copyPromise = (navigator.clipboard && navigator.clipboard.writeText) ? navigator.clipboard.writeText(_url).catch(function(){ return _execCopyFallback2(_url); }) : _execCopyFallback2(_url);
          copyPromise.then(function(){
            var opened = false;
            try {
              var w = window.open(appScheme, '_blank');
              if (w) opened = true;
            } catch(e){}
            if (!opened) {
              try {
                var ifr = document.createElement('iframe');
                ifr.style.display = 'none';
                ifr.src = appScheme;
                document.body.appendChild(ifr);
                setTimeout(function(){ try{ document.body.removeChild(ifr); }catch(e){} }, 1000);
              } catch(e){}
            }
            try{ showToast('Link copied — open TikTok and paste'); }catch(e){}
          }).catch(function(){
            try{ window.open(appScheme, '_blank'); }catch(e){}
          });
        }
        // Open TikTok website after copying URL (desktop users can paste there)
        _copyThenOpenApp2('https://www.tiktok.com');
      }

      function shareToX(url, title){
        // open Twitter/X compose with prefilled text
        var text = (title ? (title + ' ') : '') + url;
        var intent = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text);
        window.open(intent, '_blank', 'noopener');
      }

      // Legacy direct-copy click handler removed — share popup handles clicks now.

    } catch(e) { /* ignore */ }
  })();
</script>

<script>
  (function(){
    // Client-side filtering: supports ?subject=, ?search=, ?author_name= and ?author_last_initial=.
    // All provided filters apply with AND semantics.
    try {
      var params = new URLSearchParams(window.location.search);
      var subjectParam = params.get('subject');
      var searchParam = params.get('search');
      var authorNameParam = params.get('author_name');
      var authorLastInitialParam = params.get('author_last_initial');
      var authorDepartmentParam = params.get('author_department');
      var favoritesParam = params.get('favorites');
      var favoritesActive = (favoritesParam === 'true' || favoritesParam === '1');
      var favoriteIds = [];
      if (favoritesActive) {
        try { favoriteIds = JSON.parse(localStorage.getItem('favoriteIds') || '[]'); } catch(e){ favoriteIds = []; }
        // normalize to strings
        favoriteIds = (favoriteIds || []).map(function(x){ return String(x); });
      }

      var subject = subjectParam ? subjectParam.toLowerCase() : null;
      var search = searchParam ? searchParam.toLowerCase() : null;
      var authorName = authorNameParam ? authorNameParam.toLowerCase() : null;
      var authorLastInitial = authorLastInitialParam ? authorLastInitialParam.toLowerCase() : null;
      var authorDepartment = authorDepartmentParam ? authorDepartmentParam.toLowerCase() : null;

      var searchTokens = [];
      if (search) {
        searchTokens = search.split(/\s+/).filter(function(t){ return t.length; });
      }

      var container = document.querySelector('.posts-container');
      if (!container) return;
      var items = Array.prototype.slice.call(container.querySelectorAll('.post-item'));
      var anyVisible = false;

      items.forEach(function(item){
        var subjects = (item.getAttribute('data-subjects') || '').toLowerCase();
        var title = (item.getAttribute('data-title') || '').toLowerCase();
        var files = (item.getAttribute('data-files') || '').toLowerCase();
        var desc = (item.getAttribute('data-description') || '').toLowerCase();
        var caps = (item.getAttribute('data-captions') || '').toLowerCase();
        var author = (item.getAttribute('data-author') || '').toLowerCase();
        var authorFirst = (item.getAttribute('data-author-first') || '').toLowerCase();
        var authorLastInitialToken = (item.getAttribute('data-author-last-initial') || '').toLowerCase();
        var authorDeptToken = (item.getAttribute('data-author-department') || '').toLowerCase();
        var authorFirst = (item.getAttribute('data-author-first') || '').toLowerCase();
        var authorLastInitialToken = (item.getAttribute('data-author-last-initial') || '').toLowerCase();
        var authorDeptToken = (item.getAttribute('data-author-department') || '').toLowerCase();

        var subjectMatches = true;
        if (subject) {
          subjectMatches = false;
          var tokens = subjects.split(/[,;]+/).map(function(t){ return t.trim(); });
          for (var i=0;i<tokens.length;i++){ if (tokens[i] === subject) { subjectMatches = true; break; } }
        }

        var searchMatches = true;
        if (searchTokens.length) {
          searchMatches = false;
          // if any token appears in any searchable field, count as a match
          for (var t=0;t<searchTokens.length;t++){
            var tok = searchTokens[t];
            if (!tok) continue;
            if (title.indexOf(tok) !== -1 || files.indexOf(tok) !== -1 || desc.indexOf(tok) !== -1 || caps.indexOf(tok) !== -1 || subjects.indexOf(tok) !== -1 || author.indexOf(tok) !== -1) {
              searchMatches = true;
              break;
            }
          }
        }

        var authorMatches = true;
        if (authorName) {
          authorMatches = false;
          // Prefer explicit data-author-first if available
          if (authorFirst) {
            if (authorFirst === authorName || authorFirst.indexOf(authorName) === 0) authorMatches = true;
          } else {
            var authorParts = author.split(/\s+/).filter(function(s){ return s.length; });
            if (authorParts.length) {
              var firstName = authorParts[0];
              if (firstName === authorName || firstName.indexOf(authorName) === 0) {
                authorMatches = true;
              }
            }
          }
        }
        if (authorLastInitial) {
          var lastInitialMatch = false;
          // Prefer explicit data-author-last-initial if present
          if (authorLastInitialToken) {
            if (authorLastInitialToken === authorLastInitial) lastInitialMatch = true;
          } else {
            var authorParts2 = author.split(/\s+/).filter(function(s){ return s.length; });
            for (var p=0;p<authorParts2.length;p++){
              var tok = authorParts2[p];
              if (tok.length === 1) {
                if (tok.toLowerCase() === authorLastInitial) { lastInitialMatch = true; break; }
              }
            }
          }
          authorMatches = authorMatches && lastInitialMatch;
        }

        var authorDeptMatches = true;
        if (authorDepartment) {
          authorDeptMatches = false;
          if (authorDeptToken) {
            if (authorDeptToken === authorDepartment || authorDeptToken.indexOf(authorDepartment) !== -1) authorDeptMatches = true;
          } else {
            // fallback: check in combined author string
            if (author.indexOf(authorDepartment) !== -1) authorDeptMatches = true;
          }
        }

        var favoriteMatches = true;
        if (favoritesActive) {
          var pidAttr = item.getAttribute('data-post-id') || '';
          favoriteMatches = favoriteIds.indexOf(String(pidAttr)) !== -1;
        }

        // mark whether this item matched the current filters
        if (subjectMatches && searchMatches && authorMatches && authorDeptMatches && favoriteMatches) {
          item.dataset.filtered = 'true';
          item.style.display = '';
          anyVisible = true;
        } else {
          item.dataset.filtered = 'false';
          item.style.display = 'none';
        }
      });
      // Pagination / progressive reveal: show only the first N matched items initially
      var INITIAL_SHOW = 10;
      var LOAD_BATCH = 5;
      function applyPagination(){
        var shown = 0;
        items.forEach(function(it){
          if (it.dataset.filtered === 'true' || (subject===null && search===null && authorName===null && authorLastInitial===null && authorDepartment===null && !favoritesActive)){
            if (shown < INITIAL_SHOW) {
              it.style.display = '';
              shown++;
            } else {
              // hide for now; will be revealed by intersection observer
              it.style.display = 'none';
            }
          } else {
            // keep hidden if filtered out
            it.style.display = 'none';
          }
        });

        // if nothing is visible after filters, show a message
        if (!Array.prototype.slice.call(items).some(function(it){ return it.style.display !== 'none'; })){
          var msg = document.createElement('div');
          msg.className = 'no-results';
          msg.style.padding = '1rem';
          msg.style.color = '#334155';
          if (favoritesActive) {
            msg.textContent = 'No liked posts found, try liking some posts to get started.';
          } else {
            var parts = [];
            if (searchParam) parts.push(searchParam);
            if (subjectParam) parts.push(subjectParam);
            if (authorNameParam) parts.push('author: ' + authorNameParam);
            if (authorLastInitialParam) parts.push('last initial: ' + authorLastInitialParam);
            if (authorDepartmentParam) parts.push('department: ' + authorDepartmentParam);
            var q = parts.join(' ');
            msg.textContent = 'No posts found for "' + q + '".';
          }
          container.parentNode.insertBefore(msg, container);
        }
      }

      applyPagination();

      // IntersectionObserver to progressively reveal more items
      var sentinel = document.createElement('div');
      sentinel.id = 'posts-sentinel';
      sentinel.style.width = '100%';
      sentinel.style.height = '1px';
      container.parentNode.appendChild(sentinel);

      function revealMore(){
        var toReveal = [];
        for (var i=0;i<items.length;i++){
          var it = items[i];
          if ((it.dataset.filtered === 'true' || (subject===null && search===null && authorName===null && authorLastInitial===null && authorDepartment===null && !favoritesActive)) && it.style.display === 'none'){
            toReveal.push(it);
            if (toReveal.length >= LOAD_BATCH) break;
          }
        }
        toReveal.forEach(function(it){ it.style.display = ''; });
      }

      // create observer
      var observer = null;
      try {
        observer = new IntersectionObserver(function(entries){
          entries.forEach(function(entry){
            if (entry.isIntersecting) {
              revealMore();
            }
          });
        }, { root: null, rootMargin: '200px', threshold: 0 });
        observer.observe(sentinel);
      } catch(e) { /* ignore if not supported */ }

    } catch(e) { /* fail silently */ }
  })();
</script>